(this["webpackJsonptic-tac-toe"]=this["webpackJsonptic-tac-toe"]||[]).push([[0],{173:function(t,e){},190:function(t,e,n){},192:function(t,e,n){},203:function(t,e){},209:function(t,e){},210:function(t,e){},231:function(t,e){},233:function(t,e){},244:function(t,e){},246:function(t,e){},26:function(t,e,n){"use strict";n.d(e,"a",(function(){return r})),n.d(e,"b",(function(){return a})),n.d(e,"c",(function(){return c}));var r,a,s=n(27);!function(t){t.Testnet="testnet",t.Regtest="regtest",t.Mainnet="mainnet",t.STN="STN"}(r||(r={})),function(t){t[t.ALL=65]="ALL",t[t.SINGLE=67]="SINGLE",t[t.NONE=66]="NONE",t[t.ANYONECANPAY_ALL=193]="ANYONECANPAY_ALL",t[t.ANYONECANPAY_SINGLE=195]="ANYONECANPAY_SINGLE",t[t.ANYONECANPAY_NONE=194]="ANYONECANPAY_NONE"}(a||(a={}));var c=function t(e){Object(s.a)(this,t),this.network=void 0,this.network=e}},273:function(t,e){},275:function(t,e){},280:function(t,e){},282:function(t,e){},294:function(t,e){},297:function(t,e){},362:function(t,e,n){"use strict";n.r(e);var r=n(10),a=n.n(r),s=n(185),c=n.n(s),i=(n(190),n(2)),u=n.n(i),o=n(43),l=n(6),p=(n(192),n(27)),f=n(33),h=n(45),b=n(44),d=n(1),v=function(t){var e=t.value?"https://whatsonchain.com/tx/".concat(t.value.tx):"",n=t.value?Object(d.jsx)("div",{className:"squareicon",children:t.value.n}):"";return Object(d.jsxs)("div",{className:"squarewapper",children:[Object(d.jsx)("button",{className:"".concat(t.winnerClass," square"),onClick:t.onClick,children:t.value?Object(d.jsx)("a",{href:e,target:"_blank",title:"Click to see the transaction",children:t.value.label}):t.value}),n]})},w=function(t){Object(h.a)(n,t);var e=Object(b.a)(n);function n(){return Object(p.a)(this,n),e.apply(this,arguments)}return Object(f.a)(n,[{key:"createBoard",value:function(t,e){for(var n=[],r=0,a=0;a<t;a+=1){for(var s=[],c=0;c<e;c+=1)s.push(this.renderSquare(r++));n.push(Object(d.jsx)("div",{className:"board-row",children:s},a))}return n}},{key:"renderSquare",value:function(t){var e=this,n=!this.props.winnerSquares||this.props.winnerSquares[0]!==t&&this.props.winnerSquares[1]!==t&&this.props.winnerSquares[2]!==t?"":"square--green";return Object(d.jsx)(v,{winnerClass:n,value:this.props.squares[t],onClick:function(){return e.props.onClick(t)}},t)}},{key:"render",value:function(){return Object(d.jsx)("div",{children:this.createBoard(3,3)})}}]),n}(a.a.Component),x=n(5),j=n(26),g=n(59),O=n.n(g),m=function(){function t(){Object(p.a)(this,t)}return Object(f.a)(t,null,[{key:"setWallet",value:function(e){t.wallet=e}},{key:"version",value:function(){return"0.0.1"}},{key:"loadContract",value:function(t){return O.a.get(t,{timeout:1e4}).then((function(t){var e=Object(x.buildContractClass)(t.data);return{contractClass:e,types:Object(x.buildTypeClasses)(e)}}))}},{key:"getChangeAddress",value:function(){var e=Object(l.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.wallet.getRawChangeAddress());case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"sendRawTx",value:function(){var e=Object(l.a)(u.a.mark((function e(n){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.wallet.sendRawTransaction(n));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"deploy",value:function(){var e=Object(l.a)(u.a.mark((function e(n,r){var a,s;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.wallet,e.next=3,t.wallet.getRawChangeAddress();case 3:return s=e.sent,e.abrupt("return",a.listUnspent(r,{purpose:"tic-tac-toe"}).then((function(t){var e=new x.bsv.Transaction;return e.from([t[0]]).addOutput(new x.bsv.Transaction.Output({script:n.lockingScript,satoshis:r})).change(s),a.signRawTransaction(e.toString(),t[0].script,t[0].satoshis,0,j.b.ALL)})).then(function(){var e=Object(l.a)(u.a.mark((function e(n){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.sendRawTx(n);case 2:return e.abrupt("return",n);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"call",value:function(){var e=Object(l.a)(u.a.mark((function e(n,r){var a,s;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.wallet,(a=new x.bsv.Transaction).addInput(new x.bsv.Transaction.Input({prevTxId:n.txId,outputIndex:n.outputIndex,script:new x.bsv.Script,output:new x.bsv.Transaction.Output({script:n.script,satoshis:n.satoshis})})),r(a),s=a.toString(),e.next=7,t.sendRawTx(s);case 7:return e.abrupt("return",s);case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}]),t}();m.wallet=void 0;var y="alice",k="bob",N=function(t){return localStorage.getItem(t)},A=function(t,e){localStorage.setItem(t,e)},S=function(t){var e=N(t),n=new x.bsv.PrivateKey.fromWIF(e),r=x.bsv.PublicKey.fromPrivateKey(n);return Object(x.toHex)(r)},T=function(t){var e=N(t);return new x.bsv.PrivateKey.fromWIF(e).toAddress().toString()},I=function(){return localStorage.player||y},C=function(t){localStorage.setItem("player",t)},P={get:function(){var t=localStorage.game;return t?JSON.parse(t):{}},set:function(t){localStorage.setItem("game",JSON.stringify(t))},update:function(t){var e=P.get();localStorage.setItem("game",JSON.stringify(Object.assign(e,t)))},clear:function(){localStorage.setItem("game",JSON.stringify({}))}},E={add:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=new x.bsv.Transaction(t),r=E.get(),a={utxo:{txId:n.id,outputIndex:e,satoshis:n.outputs[e].satoshis,script:n.outputs[e].script.toHex()},rawTx:t};return r.push(a),E.set(r),a},get:function(){var t=localStorage.utxos;return t?JSON.parse(t):[]},set:function(t){localStorage.setItem("utxos",JSON.stringify(t))},clear:function(){localStorage.setItem("utxos",JSON.stringify([]))},getlast:function(){var t=E.get();return t[t.length-1]},getdeploy:function(){return E.get()[0]}},B=function(t){for(var e=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]],n=0;n<e.length;n+=1){var r=Object(o.a)(e[n],3),a=r[0],s=r[1],c=r[2];if(t[a]&&t[s]&&t[c]&&t[a].label===t[s].label&&t[a].label===t[c].label)return{winner:t[a],winnerRow:e[n]}}return{winner:null,winnerRow:null}},_=function(t){return{0:"row: 1, col: 1",1:"row: 1, col: 2",2:"row: 1, col: 3",3:"row: 2, col: 1",4:"row: 2, col: 2",5:"row: 2, col: 3",6:"row: 3, col: 1",7:"row: 3, col: 2",8:"row: 3, col: 3"}[t]},q={history:[{squares:Array(9).fill(null)}],currentStepNumber:0,isAliceTurn:!0},R=function(t){var e=t.history.slice(0,t.currentStepNumber+1),n=e[e.length-1].squares.slice();if(t.currentStepNumber>0)return{isAliceTurn:t.isAliceTurn,board:n.map((function(t){return t&&"X"===t.label?1:t&&"O"===t.label?2:0}))}},L=function(t){Object(h.a)(n,t);var e=Object(b.a)(n);function n(t){var r;Object(p.a)(this,n),r=e.call(this,t);var a=P.get();return 0!==Object.keys(a).length?r.state=a:r.state=q,r.attachState(),r}return Object(f.a)(n,[{key:"clean",value:function(){this.setState(q)}},{key:"canMove",value:function(t,e,n){var r=P.get();if(!r||0===Object.keys(r).length)return alert("Please start game first."),!1;if(B(n).winner||n[e])return!1;var a=I();return!(a!==y||!t)||(a===k&&!this.state.isAliceTurn||(alert("now is ".concat(this.state.isAliceTurn?"Alice":"Bob"," turn ")),!1))}},{key:"attachState",value:function(){var t=R(this.state);t&&this.props.contractInstance&&(this.props.contractInstance.isAliceTurn=t.isAliceTurn,this.props.contractInstance.board=t.board)}},{key:"handleClick",value:function(){var t=Object(l.a)(u.a.mark((function t(e){var n,r,a,s,c,i,o=this;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=this.state.history.slice(0,this.state.currentStepNumber+1),r=n[n.length-1],a=r.squares.slice(),this.canMove(this.state.isAliceTurn,e,a)){t.next=6;break}return console.error("can not move now!"),t.abrupt("return");case 6:s=Object.assign({},this.state),a[e]={label:this.state.isAliceTurn?"X":"O"},c={history:n.concat([{squares:a,currentLocation:_(e),stepNumber:n.length}]),isAliceTurn:!this.state.isAliceTurn,currentStepNumber:n.length},this.setState(c),i=E.getlast().utxo,m.call(i,(function(t){if(B(a).winner){var r=T(I());t.setOutput(0,(function(t){return new x.bsv.Transaction.Output({script:x.bsv.Script.buildPublicKeyHashOut(r),satoshis:i.satoshis-t.getEstimateFee()})}))}else if(n.length>=9)t.setOutput(0,(function(t){return new x.bsv.Transaction.Output({script:x.bsv.Script.buildPublicKeyHashOut(T(y)),satoshis:(i.satoshis-t.getEstimateFee())/2})})).setOutput(1,(function(t){return new x.bsv.Transaction.Output({script:x.bsv.Script.buildPublicKeyHashOut(T(k)),satoshis:(i.satoshis-t.getEstimateFee())/2})}));else{var s=R(c),u=o.props.contractInstance.getNewStateScript(s);t.setOutput(0,(function(t){var e=i.satoshis-t.getEstimateFee();return new x.bsv.Transaction.Output({script:u,satoshis:e})}))}t.setInputScript(0,(function(t,n){var r=Object(x.getPreimage)(t,n.script,n.satoshis),a=new x.bsv.PrivateKey.fromWIF(N(I())),s=Object(x.signTx)(t,a,n.script,n.satoshis),c=i.satoshis-t.getEstimateFee();if(c<1)throw alert("Not enough funds."),new Error("Not enough funds.");return o.props.contractInstance.move(e,s,c,r).toScript()})).seal()})).then((function(t){var r=E.add(t);a[e].tx=r.utxo.txId,a[e].n=n.length,C(o.state.isAliceTurn?y:k);var s=Object.assign({},o.state,{history:n.concat([{squares:a,currentLocation:_(e),stepNumber:n.length}])});o.setState(s),P.update(s),o.attachState()})).catch((function(t){o.setState(s),console.error("call contract fail",t)}));case 12:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"render",value:function(){var t,e,n,r,a=this,s=this.state.history,c=s[this.state.currentStepNumber],i=B(c.squares),u=i.winner,o=i.winnerRow,l=E.getdeploy(),p=E.getlast();if(n=I()===k?Object(d.jsxs)("div",{className:"bob",children:["Bob",Object(d.jsx)("img",{src:"/tic-tac-toe/bob.png"})]}):Object(d.jsxs)("div",{className:"alice",children:["Alice",Object(d.jsx)("img",{src:"/tic-tac-toe/alice.jpg"})]}),l&&(r=Object(d.jsxs)("div",{className:"bet",children:[Object(d.jsx)("a",{href:"https://whatsonchain.com/tx/".concat(l.utxo.txId),target:"_blank",children:"Bet transaction"})," "]})),u){var f="X"===u.label?"Alice":"Bob";t="Winner is ".concat(f),p&&(e=Object(d.jsxs)("div",{className:"end",children:[Object(d.jsx)("a",{href:"https://whatsonchain.com/tx/".concat(p.utxo.txId),target:"_blank",children:"Withdraw transaction"})," "]}))}else if(10===s.length)t="Draw. No one won.",p&&(e=Object(d.jsxs)("div",{className:"end",children:[Object(d.jsx)("a",{href:"https://whatsonchain.com/tx/".concat(p.utxo.txId),target:"_blank",children:"Withdraw transaction"})," "]}));else{var h=this.state.isAliceTurn?"Alice":"Bob";t="Next player: ".concat(h)}return Object(d.jsx)("div",{className:"game",children:Object(d.jsxs)("div",{className:"game-board",children:[Object(d.jsxs)("div",{className:"game-title",children:[n,Object(d.jsxs)("div",{className:"game-status",children:[" ",t," "]})]}),Object(d.jsx)(w,{squares:c.squares,winnerSquares:o,onClick:function(t){return a.handleClick(t)}}),Object(d.jsxs)("div",{className:"game-bottom",children:[r,e]})]})})}}]),n}(a.a.Component);var G=function(t){var e=Object(r.useRef)(null),n=function(){var n=Object(l.a)(u.a.mark((function n(r){var a,s;return u.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(m.wallet){n.next=3;break}return alert("Pelease create wallet first"),n.abrupt("return");case 3:if(!((a=parseInt(e.current.value))<5e4)){n.next=7;break}return alert("invalid amount, at least 50000 satoshis"),n.abrupt("return");case 7:if(isNaN(a)){n.next=17;break}return n.next=10,m.wallet.getbalance();case 10:if(s=n.sent,!(a>s)){n.next=14;break}return alert("Not enough funds. Please fund your wallet address first"),n.abrupt("return");case 14:t.startBet(a),n.next=18;break;case 17:console.error("".concat(e.current.value," is not number"));case 18:case"end":return n.stop()}}),n)})));return function(t){return n.apply(this,arguments)}}();return t.started?Object(d.jsxs)("div",{children:["The game is in progress ...",Object(d.jsx)("button",{className:"pure-button cancel",onClick:function(e){t.cancelBet()},children:"Restart"})]}):Object(d.jsxs)("div",{children:[Object(d.jsxs)("label",{children:["Bet amount:",Object(d.jsx)("input",{ref:e,type:"number",name:"amount",min:"1",defaultValue:5e4,placeholder:"in satoshis"})]}),Object(d.jsx)("button",{className:"start",onClick:n,children:"Start"})]})},F=n(42),K=function(t){var e=Object(r.useState)(0),n=Object(o.a)(e,2),a=n[0],s=n[1];Object(r.useEffect)(Object(l.a)(u.a.mark((function t(){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:m.wallet&&m.wallet.getbalance().then((function(t){s(t)}));case 1:case"end":return t.stop()}}),t)}))),[]);var c=function(){var t=Object(l.a)(u.a.mark((function t(e){var n;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=new F.a,t.next=3,n.isConnect();case 3:if(!t.sent){t.next=7;break}return t.next=7,n.exitAccount();case 7:m.setWallet(void 0),window.location.reload();case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return Object(d.jsx)("div",{className:"wallet",children:Object(d.jsxs)("div",{className:"walletInfo",children:[Object(d.jsx)("div",{className:"balance",children:Object(d.jsxs)("label",{children:["Balance: ",a," ",Object(d.jsx)("span",{children:" (satoshis)"})]})}),Object(d.jsx)("button",{className:"pure-button button-large",onClick:c,children:"Logout"})]})})},H=function(t){var e=function(){var t=Object(l.a)(u.a.mark((function t(e){var n;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n=new F.a,t.next=4,n.requestAccount("tic-tac-toe");case 4:t.sent&&window.location.reload(),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(0),console.error("requestAccount error",t.t0);case 11:case"end":return t.stop()}}),t,null,[[0,8]])})));return function(e){return t.apply(this,arguments)}}();return Object(d.jsx)("div",{className:"auth",children:Object(d.jsx)("div",{children:Object(d.jsx)("button",{className:"pure-button button-large sensilet",onClick:e,children:"Sensilet"})})})};function D(t,e){return U.apply(this,arguments)}function U(){return(U=Object(l.a)(u.a.mark((function t(e,n){var r,a;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,m.loadContract("/tic-tac-toe/tictactoe_release_desc.json");case 2:return r=t.sent,a=r.contractClass,t.abrupt("return",new a(new x.PubKey(e),new x.PubKey(n),!0,[0,0,0,0,0,0,0,0,0]));case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var Y=function(){a.a.useReducer((function(t){return!t}))[1];var t=a.a.createRef(),e=Object(r.useState)({started:!1,isConnected:!1,instance:null}),n=Object(o.a)(e,2),s=n[0],c=n[1];Object(r.useEffect)(Object(l.a)(u.a.mark((function t(){var e;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=setTimeout(Object(l.a)(u.a.mark((function t(){var e,n,r;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=new F.a,t.next=3,e.isConnect();case 3:return(n=t.sent)&&(m.setWallet(e),console.log("sensilet login ...")),t.next=7,D(S(y),S(k));case 7:r=t.sent,c({started:Object.keys(P.get()).length>0,isConnected:n,instance:r});case 9:case"end":return t.stop()}}),t)}))),100),t.abrupt("return",(function(){clearTimeout(e)}));case 2:case"end":return t.stop()}}),t)}))),[]);var i=function(){var t=Object(l.a)(u.a.mark((function t(e){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:m.wallet&&s.instance&&m.deploy(s.instance,e).then((function(t){var n={amount:e,name:"tic-tac-toe",date:new Date,history:[{squares:Array(9).fill(null)}],currentStepNumber:0,isAliceTurn:!0};E.add(t),P.set(n),C(y),c(Object.assign({},s,{started:!0}))}));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),p=function(){var e=Object(l.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:P.clear(),E.clear(),C(y),s.instance&&(s.instance.isAliceTurn=!0,s.instance.board=[0,0,0,0,0,0,0,0,0]),t.current.clean(),c({started:!1,isConnected:s.isConnected,instance:s.instance});case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(d.jsx)("div",{className:"App",children:Object(d.jsxs)("header",{className:"App-header",children:[Object(d.jsx)("h2",{children:"Play Tic-Tac-Toe on Bitcoin"}),Object(d.jsx)(G,{startBet:i,cancelBet:p,started:s.started}),Object(d.jsx)(L,{ref:t,contractInstance:s.instance}),s.isConnected?Object(d.jsx)(K,{}):Object(d.jsx)(H,{})]})})},W=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,363)).then((function(e){var n=e.getCLS,r=e.getFID,a=e.getFCP,s=e.getLCP,c=e.getTTFB;n(t),r(t),a(t),s(t),c(t)}))};!function(){if(!N(y)){var t=new x.bsv.PrivateKey.fromRandom;A(y,t.toWIF())}if(!N(k)){var e=new x.bsv.PrivateKey.fromRandom;A(k,e.toWIF())}}(),c.a.render(Object(d.jsx)(a.a.StrictMode,{children:Object(d.jsx)(Y,{})}),document.getElementById("root")),W()},42:function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return b}));var r=n(2),a=n.n(r),s=n(6),c=n(27),i=n(33),u=n(45),o=n(44),l=n(26),p=n(59),f=n.n(p),h=n(5),b=function(e){Object(u.a)(r,e);var n=Object(o.a)(r);function r(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l.a.Mainnet;return Object(c.a)(this,r),(t=n.call(this,e)).API_PREFIX=void 0,t.sensilet=void 0,t.API_PREFIX="https://api.whatsonchain.com/v1/bsv/".concat(e==l.a.Testnet?"test":"main"),"undefined"!==typeof window.sensilet?(console.log(r.DEBUG_TAG,"Sensilet is installed!"),t.sensilet=window.sensilet):console.warn(r.DEBUG_TAG,"sensilet is not installed"),t}return Object(i.a)(r,[{key:"requestAccount",value:function(t,e){if(!this.sensilet){if("undefined"!==typeof window.sensilet)return console.log(r.DEBUG_TAG,"Sensilet is installed!"),this.sensilet=window.sensilet,this.sensilet.requestAccount();alert("sensilet is not installed"),window.open("https://sensilet.com/","_blank")}return this.sensilet.requestAccount()}},{key:"isConnect",value:function(){var t=Object(s.a)(a.a.mark((function t(){var e;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,console.log(r.DEBUG_TAG,"isConnect"),"undefined"===typeof this.sensilet){t.next=8;break}return t.next=5,this.sensilet.isConnect();case 5:return e=t.sent,console.log(r.DEBUG_TAG,"connect state",e),t.abrupt("return",e);case 8:t.next=12;break;case 10:t.prev=10,t.t0=t.catch(0);case 12:return t.abrupt("return",Promise.resolve(!1));case 13:case"end":return t.stop()}}),t,this,[[0,10]])})));return function(){return t.apply(this,arguments)}}()},{key:"getbalance",value:function(){var t=Object(s.a)(a.a.mark((function t(){var e;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.sensilet.getBsvBalance();case 3:return e=t.sent,console.log(r.DEBUG_TAG,"getbalance",e.balance),t.abrupt("return",Promise.resolve(e.balance.total));case 8:t.prev=8,t.t0=t.catch(0),console.error("getbalance error",t.t0);case 11:return t.abrupt("return",Promise.resolve(0));case 12:case"end":return t.stop()}}),t,this,[[0,8]])})));return function(){return t.apply(this,arguments)}}()},{key:"signRawTransaction",value:function(){var e=Object(s.a)(a.a.mark((function e(n,r,s,c,i){var u,o,l;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=new h.bsv.Transaction(n),e.next=3,this.sensilet.signTx({list:[{txHex:n,address:d(r),scriptHex:r,inputIndex:c,satoshis:s,sigtype:i}]});case 3:return o=e.sent,l=(new h.bsv.Script).add(t.from(o.sigList[0].sig,"hex")).add(t.from(o.sigList[0].publicKey,"hex")),u.inputs[c].setScript(l),e.abrupt("return",u.toString());case 7:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a,s){return e.apply(this,arguments)}}()},{key:"getSignature",value:function(){var t=Object(s.a)(a.a.mark((function t(e,n,r,s,c,i){var u;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.sensilet.signTx({list:[{txHex:e,address:i,inputIndex:s,satoshis:r,scriptHex:n,sigtype:c}]});case 2:return u=t.sent,t.abrupt("return",{signature:u.sigList[0].sig,publickey:u.sigList[0].publickey});case 4:case"end":return t.stop()}}),t,this)})));return function(e,n,r,a,s,c){return t.apply(this,arguments)}}()},{key:"sendRawTransaction",value:function(){var t=Object(s.a)(a.a.mark((function t(e){var n,r,s;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Math.max(1,e.length/2/1024),r=Math.max(1e4,1e3*n),t.prev=2,t.next=5,f.a.post("".concat(this.API_PREFIX,"/tx/raw"),{txhex:e},{timeout:r});case 5:return s=t.sent,t.abrupt("return",s.data);case 9:throw t.prev=9,t.t0=t.catch(2),new Error("sendRawTransaction error: ");case 12:case"end":return t.stop()}}),t,this,[[2,9]])})));return function(e){return t.apply(this,arguments)}}()},{key:"listUnspent",value:function(){var t=Object(s.a)(a.a.mark((function t(e,n){var s;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.sensilet.getAddress();case 2:return s=t.sent,console.log(r.DEBUG_TAG,"listUnspent",s),t.abrupt("return",f.a.get("".concat(this.API_PREFIX,"/address/").concat(s,"/unspent"),{timeout:1e4}).then((function(t){return t.data.filter((function(t){return t.value>=e})).map((function(t){return{txId:t.tx_hash,outputIndex:t.tx_pos,satoshis:t.value,script:h.bsv.Script.buildPublicKeyHashOut(s).toHex()}}))})));case 5:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"getRawChangeAddress",value:function(){var t=Object(s.a)(a.a.mark((function t(e){return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.sensilet.getAddress());case 1:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"getPublicKey",value:function(){var t=Object(s.a)(a.a.mark((function t(e){return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.sensilet.getPublicKey());case 1:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"exitAccount",value:function(){var t=Object(s.a)(a.a.mark((function t(){return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.sensilet.exitAccount();case 3:return t.abrupt("return",!0);case 6:t.prev=6,t.t0=t.catch(0),console.error(r.DEBUG_TAG,"exitAccount error",t.t0);case 9:return t.abrupt("return",!1);case 10:case"end":return t.stop()}}),t,this,[[0,6]])})));return function(){return t.apply(this,arguments)}}()}]),r}(l.c);function d(t){var e=h.bsv.Script.fromHex(t).toASM().split(" ")[2];return new h.bsv.Address.fromHex("00".concat(e)).toString()}b.DEBUG_TAG="Sensilet"}).call(this,n(0).Buffer)},98:function(t,e){}},[[362,1,2]]]);
//# sourceMappingURL=main.342f95fa.chunk.js.map